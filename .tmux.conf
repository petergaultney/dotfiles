
# Reduce delay after Escape key (default 500ms). Makes Escape feel instant in TUIs.
# Added for lemonaid scratch pane UX. Safe to remove if it causes issues with
# escape sequences or function keys - it's just a responsiveness tweak.
set-option -g escape-time 10

# shortcut keys
set-option -g prefix `
unbind-key C-b
bind-key F11 set-option -g prefix C-b
bind-key F12 set-option -g prefix `
bind-key ` last-window
bind-key h send-prefix

# Lemonaid: back to previous pane (works across sessions)
bind-key b run-shell ' \
    target=$(lemonaid tmux swap "#{session_name}" "#{pane_id}"); \
    if [ -n "$target" ]; then \
        tmux switch-client -t "$(echo "$target" | cut -d"|" -f2)"; \
    fi'

# Lemonaid: mark current pane's notifications as read
bind-key m run-shell -b 'lemonaid mark-read --tty "#{pane_tty}" >/dev/null 2>&1'
bind-key l run-shell 'lemonaid tmux scratch --height 15%'

# set-option -g default-command "reattach-to-user-namespace -l fish"  # no longer necessary with >= tmux 2.6
set-option -g default-shell "/Users/peter.gaultney/.local/xonsh-env/xbin/xonsh"

set -g base-index 1
bind r source-file ~/.tmux.conf
set-option -wg allow-rename off  # allow apps to set pane title

set-option -g status on
set-option -g status-keys emacs
set-window-option -g mode-keys emacs
# set-window-option -g mode-mouse on # for old tmux
set-option -g mouse on # for newer tmux
set-window-option -g monitor-activity on
# set-option -g mouse-select-pane on
set-option -g history-limit 50000

set-option -g default-terminal "tmux-256color"
set-option -sa terminal-features ',xterm-256color:RGB'

# Extended keys support for CSI u sequences (e.g., Shift+Enter in Claude Code)
set -s extended-keys on
set -as terminal-features 'xterm*:extkeys'

# 2026-01-20: Debugging xonsh OSC 7 directory tracking with Claude Code
# pane_path (set by OSC 7) was empty - need to enable osc7 terminal feature
# See: https://github.com/tmux/tmux/issues/3098
set -as terminal-features 'xterm*:osc7'
set -g set-titles on

bind C-y paste-buffer
# bind C-w copy-selection
bind-key -T copy-mode [    send-keys -X begin-selection
bind-key -T copy-mode M-w  send-keys -X copy-pipe-and-cancel "pbcopy"
bind-key -T copy-mode ]    send-keys -X copy-selection

bind -n MouseDown1StatusLeft choose-tree -Zs  # makes it possible to click session

# split pane stuff
unbind %
bind | split-window -h
bind - split-window -v

set -g terminal-overrides 'xterm*:smcup@:rmcup@'

if-shell 'test "$(uname -s)" = "Darwin"' 'bind-key y run-shell "tmux show-buffer | pbcopy" \; display-message "Copied tmux buffer to system clipboard"'
if-shell 'test "$(uname -s)" = "Linux"' 'bind-key y run-shell "tmux show-buffer | xclip -sel clip -i" \; display-message "Copied tmux buffer to system clipboard"'
# COLORS

# https://www.ditig.com/256-colors-cheat-sheet

## Status bar design
# status line
# set -g status-utf8 on
set -g status-justify left
set -g status-bg default
set -g status-fg colour12
set -g status-interval 1

# messaging
set -g message-style fg=black
set -g message-style bg=red
set -g message-command-style fg=blue
set -g message-command-style bg=black

# window status - uses lemonaid-tmux-window-status for colored directory/process display
# Pass both #{pane_path} (OSC 7, for xonsh) and #{pane_current_path} (process, for fish/bash)
setw -g window-status-format " #I:#(lemonaid-tmux-window-status '#{pane_path}' '#{pane_current_path}' '#{pane_current_command}' '#{pane_title}') "
setw -g window-status-current-format " #I:#(lemonaid-tmux-window-status '#{pane_path}' '#{pane_current_path}' '#{pane_current_command}' '#{pane_title}') "
setw -g window-status-style none
setw -g window-status-current-style "bg=colour238,bold"
setw -g window-status-activity-style none
setw -g window-status-separator "â”‚"

# The statusbar {

set -g status-position bottom
set -g status-style bg=colour234
set -g status-style fg="colour137"
set -g status-left '#(lemonaid-tmux-session-name "#{session_name}")'
set -g status-right '#[fg=colour233,bg=colour241,bold] %d/%m #[fg=colour233,bg=colour255,bold] %H:%M:%S '
set -g status-right-length 50
set -g status-left-length 20

# }
